<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="#">
    <title>채팅 서비스</title>
    <!-- Bootstrap core CSS -->
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">-->

<!--    &lt;!&ndash; 부가적인 테마 &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<!--    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>-->


</head>
<body>
<div class="container">

<!--    <input type="text" id="nickname" class="form-inline" placeholder="닉네임을 입력해주세요" required autofocus>-->
<!--    <button class="btn btn-primary" id="name">확인</button>-->
    <div>
        <h1>채팅방</h1>
    </div>
    <div id="chatroom" class="card-body" style="width: 30em;height: 40em; background-color: #a4a2a8; border: rgba(0,95,8,0.69); overflow:auto"></div>

    <div class="py-2">

        <input type="text" id="message" style="height : 30px; width : 30em" placeholder="내용을 입력하세요" autofocus onkeydown="if(event.keyCode == 13) send();">
    </div>
<!--    <button type="button" class="btn btn-info" id="send">전송</button>-->
</div>



</body>
<script>

    let webSocket;
    const nickname = prompt('닉네임을 입력해주세요');
    connect();

    function connect() {
        webSocket = new WebSocket("ws://localhost:8080/chat");
        webSocket.onopen = onOpen;
        webSocket.onclose = onClose;
        webSocket.onmessage = onMessage;
    }

    function disconnect() {
        webSocket.send(nickname + "님이 퇴장하셨습니다 | disconnect");
        webSocket.close();
    }

    function send() {
        const msg = document.getElementById("message").value;
        webSocket.send(nickname + " : " + msg);
        document.getElementById("message").value = "";
    }

    function onOpen() {
        webSocket.send(nickname + "님이 입장하셨습니다.");
    }

    function onMessage(e) {
        const data = e.data;

        let split = data.split(" : ");
        const sessionID = split[0];


        if (sessionID === nickname) {
            console.log("내가 씀");
            const chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<p style=\"text-align:right;\">" + data + "</p>"; // 내가 친 챗은 오른쪽에 나오도록
            chatroom.scrollBy(0, 500);

        } else {
            // console.log("다름")
            // console.log("sessionID 타입 : "+ sessionID.length)
            // console.log("nickname 타입 : "+ nickname.length)
            const chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<p>" + data + "</p>";
            chatroom.scrollBy(0, 500);

        }


    }

    function onClose() {
        // console.log(nickname + "연결 끊김")
        // webSocket.send(nickname + "님이 퇴장하셨습니다");
        // webSocket.close();
    }
</script>
</html>
